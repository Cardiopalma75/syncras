root{--violet:#6C5CE7;--bg:#f3f4f6;--card:#fff;--border:#d1d5db;--text:#1f2937;--success:#10b981;--danger:#ef4444;--bet:#facc15}
    body{font-family:sans-serif;margin:20px;background:var(--bg);color:var(--text)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}
    button{cursor:pointer;background:var(--violet);color:#fff;border:0;font-weight:700;padding:12px 20px;border-radius:8px}
    table{width:100%;border-collapse:collapse;font-size:12px;margin-top:10px}
    th,td{padding:10px;text-align:left;border-bottom:1px solid #eee}
    th{background:#f9fafb;text-transform:uppercase;color:#6b7280;font-size:10px}
    .stat-bar{display:flex;gap:10px;margin-bottom:20px}
    .stat-box{background:#fff;padding:10px 15px;border-radius:8px;border:1px solid var(--border);flex:1;text-align:center}
    .hit{color:var(--success);font-weight:bold}
    .miss{color:var(--danger);font-weight:bold}
    .bet-now{background:black; color:var(--bet); padding:4px 8px; border-radius:4px; font-weight:bold; display:inline-block}
    .tag{padding:3px 6px;border-radius:4px;font-size:10px;background:#e5e7eb;font-weight:bold}
  </style>
</head>
<body>

<h2>Syncras Pro â€“ Dashboard Operativa</h2>

<div class="card">
  <div class="grid">
    <div>
      <label><b>1. File Risultati (Storico)</b></label><br>
      <input id="fRes" type="file" accept=".csv">
    </div>
    <div>
      <label><b>2. File Quote (Prossimi Match)</b></label><br>
      <input id="fQuo" type="file" accept=".csv">
    </div>
    <div style="display:flex;align-items:flex-end">
      <button onclick="elabora()">GENERA SEGNALI</button>
    </div>
  </div>
</div>

<div id="dashboard"></div>
<div id="output"></div>

<script>
let teamLeagueMap = {};

function parseCSV(text) {
    const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
    const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
    return lines.slice(1).map(line => {
        const cols = line.split(',');
        let obj = {};
        headers.forEach((h, i) => obj[h] = cols[i]);
        return obj;
    });
}

function getBaseline(results) {
    const stats = {};
    results.forEach(r => {
        const lg = r.league || "Unknown";
        if (!stats[lg]) stats[lg] = { t: 0, o: 0 };
        const total = parseFloat(r.fthg) + parseFloat(r.ftag);
        if (!isNaN(total)) {
            stats[lg].t++;
            if (total > 2.5) stats[lg].o++;
            teamLeagueMap[r.home_team] = lg;
            teamLeagueMap[r.away_team] = lg;
        }
    });
    return stats;
}

async function elabora() {
    const resFile = document.getElementById('fRes').files[0];
    const quoFile = document.getElementById('fQuo').files[0];
    if(!resFile || !quoFile) return alert("Carica entrambi i file!");

    const resData = parseCSV(await resFile.text());
    const quoData = parseCSV(await quoFile.text());
    const baselines = getBaseline(resData);

    let html = `<table><thead><tr><th>Data</th><th>Match</th><th>Lega</th><th>Base</th><th>P(Over)</th><th>Stato / Esito</th></tr></thead><tbody>`;
    
    let totalBets = 0, hits = 0, profit = 0;
    const QUOTA_MEDIA = 1.70; // Modificata come richiesto

    quoData.forEach(q => {
        const home = q.home_team;
        const lg = teamLeagueMap[home] || "N/A";
        const base = baselines[lg] ? (baselines[lg].o / baselines[lg].t) : 0.50;
        
        const qX = parseFloat(q.b365_x);
        let pOver = base;
        if(qX > 3.60) pOver += 0.05;
        if(qX > 4.50) pOver += 0.10;

<!-- Cookie Banner + GA (carica solo dopo consenso) -->
<div id="cookie-banner" role="dialog" aria-live="polite" aria-label="Preferenze cookie">
  <p>
    Usiamo cookie tecnici per il funzionamento del sito e, solo con il tuo consenso,
    misuriamo le visite con Google Analytics (dati anonimizzati).
    Alcuni link potrebbero essere di affiliazione.
    Leggi <a href="/cookie.html">Cookie Policy</a> e <a href="/privacy.html">Privacy Policy</a>.
  </p>

  <div class="cookie-actions">
    <button type="button" class="cookie-reject" onclick="rejectCookies()">
      Rifiuta
    </button>
    <button id="cookie-btn" type="button" class="cookie-accept" onclick="acceptCookies()">
      Accetta e continua
    </button>
  </div>

  <p class="cookie-mini">
    Puoi cambiare idea quando vuoi dal link “Modifica consenso cookie” nel footer.
  </p>
</div>

<style>
  #cookie-banner{
    position:fixed;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    max-width:90%;
    width:460px;
    background:#fff;
    border:2px solid #6C5CE7;
    border-radius:12px;
    padding:16px;
    box-shadow:0 8px 18px rgba(0,0,0,0.18);
    z-index:9999;
    font-family: Arial, sans-serif;
    display:none;
  }
  #cookie-banner p{
    margin:0 0 12px 0;
    font-size:0.95rem;
    color:#111827;
    line-height:1.45;
  }
  #cookie-banner a{
    color:#4B3ACB;
    font-weight:800;
    text-decoration:none;
  }
  #cookie-banner a:hover{ text-decoration:underline; }

  .cookie-actions{
    display:flex;
    gap:10px;
    margin-top:8px;
  }
  .cookie-reject{
    flex:1;
    background:#fff !important;
    color:#111827 !important;
    border:2px solid #6C5CE7 !important;
    padding:10px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:800;
  }
  .cookie-accept{
    flex:1;
    background:#6C5CE7;
    color:#fff;
    border:2px solid #6C5CE7;
    padding:10px 16px;
    border-radius:8px;
    cursor:pointer;
    font-weight:900;
  }
  .cookie-accept:hover{ background:#4B3ACB; }

  .cookie-mini{
    margin-top:10px !important;
    font-size:0.82rem !important;
    opacity:0.9;
  }
</style>

<script>
(function(){
  const GA_ID = 'G-CFTTCYDZ2P';
  const CONSENT_KEY = 'syncras_cookie_consent';

  // Blocco preventivo: GA disabilitato finché non c'è consenso
  window['ga-disable-' + GA_ID] = true;

  function loadGoogleAnalytics(){
    if (window.__syncrasGaLoaded) return;
    window.__syncrasGaLoaded = true;

    window['ga-disable-' + GA_ID] = false;

    const gaScript = document.createElement('script');
    gaScript.async = true;
    gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
    document.head.appendChild(gaScript);

    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    window.gtag = gtag;

    gtag('js', new Date());
    gtag('config', GA_ID, { anonymize_ip: true });
  }

  function showBanner(){
    const b = document.getElementById('cookie-banner');
    if (b) b.style.display = 'block';
  }
  function hideBanner(){
    const b = document.getElementById('cookie-banner');
    if (b) b.style.display = 'none';
  }

  window.acceptCookies = function(){
    localStorage.setItem(CONSENT_KEY, 'yes');
    hideBanner();
    loadGoogleAnalytics();
  };

  window.rejectCookies = function(){
    localStorage.setItem(CONSENT_KEY, 'no');
    hideBanner();
    window['ga-disable-' + GA_ID] = true;
  };

  window.revokeCookies = function(){
    localStorage.removeItem(CONSENT_KEY);
    window['ga-disable-' + GA_ID] = true;
    showBanner();
  };

  document.addEventListener('DOMContentLoaded', function(){
    const consent = localStorage.getItem(CONSENT_KEY);

    if (consent === 'yes'){
      loadGoogleAnalytics();
    } else if (consent === 'no'){
      window['ga-disable-' + GA_ID] = true;
    } else {
      showBanner();
    }
  });
})();
</script>

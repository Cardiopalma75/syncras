<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Test Bilanciamento Fotovoltaico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial, sans-serif;
  background:#f7f7fb;
  padding:20px;
  color:#333;
}
.container{
  max-width:720px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}
h1{margin-top:0;color:#4B3ACB}
label{font-weight:600;display:block;margin-top:14px}
input,select{
  width:100%;
  padding:8px;
  font-size:1rem;
  margin-top:4px;
}
input[type=range]{padding:0}
button{
  margin-top:18px;
  padding:10px 16px;
  background:#6C5CE7;
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:1rem;
  cursor:pointer;
}
button:hover{background:#4B3ACB}

/* Barra bilanciamento */
.balance-box{
  margin-top:24px;
}
.bar{
  height:18px;
  border-radius:999px;
  background:linear-gradient(90deg,#dc2626,#facc15,#16a34a);
  position:relative;
}
.dot{
  position:absolute;
  top:-6px;
  width:30px;
  height:30px;
  border-radius:50%;
  background:#111;
  color:#fff;
  font-size:.8rem;
  display:flex;
  align-items:center;
  justify-content:center;
  transform:translateX(-50%);
}
.status{
  margin-top:10px;
  font-weight:800;
}
.status.ok{color:#16a34a}
.status.warn{color:#ca8a04}
.status.bad{color:#dc2626}

.advice{
  margin-top:10px;
  background:#f1f5f9;
  padding:10px;
  border-radius:8px;
  font-size:.95rem;
}
.small{
  font-size:.8rem;
  color:#555;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="container">

<h1>Bilanciamento impianto FV</h1>

<label>Produzione annua (kWh)</label>
<input type="number" id="prodAnnua" value="6800">

<label>Consumo annuo casa (kWh)</label>
<input type="number" id="consumoCasa" value="3000">

<label>Batteria (kWh)</label>
<input type="number" id="batteria" value="7.5" min="0" max="50" step="0.5">

<label>
Carichi spostabili di giorno (kWh/giorno)
</label>
<input type="range" id="carichi" min="0" max="8" step="0.5" value="3">
<div class="small">
Quanto riesci a far lavorare casa/elettrodomestici nelle ore di sole
</div>

<button onclick="calcola()">Calcola bilanciamento</button>

<div class="balance-box" id="result" style="display:none">

  <div class="bar">
    <div class="dot" id="dot">‚úì</div>
  </div>

  <div class="status" id="statusText"></div>

  <div class="advice" id="adviceText"></div>

  <div class="small" id="detailText"></div>

</div>

</div>

<script>
function calcola(){
  const prodAnnua = Number(prodAnnuaEl.value);
  const consumoCasa = Number(consumoCasaEl.value);
  const batteria = Number(batteriaEl.value);
  const carichi = Number(carichiEl.value);

  const prodGiornaliera = prodAnnua / 365;

  // 1. Autoconsumo base (dipende da rapporto produzione/consumi)
  let quotaBase = 0.28;
  if(prodAnnua > consumoCasa * 1.5) quotaBase = 0.22;

  // 2. Batteria vs produzione
  const rapportoBatProd = batteria / prodGiornaliera;

  let quotaBatteria = 0;
  if(batteria > 0){
    if(rapportoBatProd >= 1.4) quotaBatteria = 0.60;
    else if(rapportoBatProd >= 0.8) quotaBatteria = 0.45;
    else quotaBatteria = 0.30;
  }

  // 3. Carichi spostati (massimo realistico ~20%)
  const quotaCarichi = Math.min(carichi / prodGiornaliera, 0.20);

  let quotaTot = quotaBase + quotaBatteria + quotaCarichi;
  if(quotaTot > 0.90) quotaTot = 0.90;

  // POSIZIONE BARRA
  const perc = Math.round(quotaTot * 100);
  dot.style.left = perc + "%";

  // GIUDIZIO
  let status = "";
  let cls = "";
  let advice = "";

  if(quotaTot >= 0.65){
    status = "Bilanciamento ottimale";
    cls = "ok";
    advice = "Impianto, batteria e abitudini sono ben proporzionati.";
  } else if(quotaTot >= 0.45){
    status = "Bilanciamento migliorabile";
    cls = "warn";
    advice = "Funziona, ma puoi aumentare il rendimento con piccoli aggiustamenti.";
  } else {
    status = "Sistema sbilanciato";
    cls = "bad";
    advice = "Parte dell‚Äôinvestimento non sta lavorando in modo efficiente.";
  }

  // CONSIGLI MIRATI
  if(rapportoBatProd < 0.6){
    advice += "<br>üîã Prova ad aumentare leggermente la batteria.";
  }
  if(rapportoBatProd > 1.6){
    advice += "<br>‚ö†Ô∏è Batteria molto grande rispetto alla produzione: valuta se ridurla.";
  }
  if(prodAnnua > consumoCasa * 2){
    advice += "<br>‚òÄÔ∏è Produzione molto alta rispetto ai consumi: valuta auto elettrica o PDC.";
  }
  if(prodAnnua < consumoCasa * 0.7){
    advice += "<br>üè† Consumi elevati rispetto all‚Äôimpianto: l‚Äôimpianto √® probabilmente sottodimensionato.";
  }

  statusText.textContent = status + " (" + perc + "% energia trattenuta)";
  statusText.className = "status " + cls;
  adviceText.innerHTML = advice;

  detailText.textContent =
    "Produzione media: " + prodGiornaliera.toFixed(1) + " kWh/g ‚Ä¢ " +
    "Rapporto batteria/produzione: " + rapportoBatProd.toFixed(2);

  result.style.display = "block";
}

// riferimenti
const prodAnnuaEl = document.getElementById("prodAnnua");
const consumoCasaEl = document.getElementById("consumoCasa");
const batteriaEl = document.getElementById("batteria");
const carichiEl = document.getElementById("carichi");
const dot = document.getElementById("dot");
const statusText = document.getElementById("statusText");
const adviceText = document.getElementById("adviceText");
const detailText = document.getElementById("detailText");
const result = document.getElementById("result");
</script>

</body>
</html>

